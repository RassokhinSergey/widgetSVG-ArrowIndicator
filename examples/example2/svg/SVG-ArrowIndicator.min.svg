<svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" onload="ArrowIndicator.init(evt);" viewBox="0 0 200 200"><style>text{font-family:Helvetica;fill:#fff;font-size:1.375em}#text-value{font-size:1.75em;font-weight:700}</style><script type="application/ecmascript"><![CDATA[ArrowIndicator=function(){"use strict";const t=window.console,o={options:{id:"objIndicatorVolt",url:"/handlers/getIndicatorVolt.php",interval:60,textName:"Вх.Напряжение",data2:[160,210,240,280],indicatorColors:["#0f6eb3","#00997b","red"],cx:null,cy:null,maxAngle:230,height:200,indicatorBgWidth:25,indicatorWidth:4,indicatorRadiuses:70,diagramcentercy:60},svg:{doc:null}};return o.methods={init:function(e){let n;try{o.svg.doc=e.target.ownerDocument,n=window.frameElement}catch(o){return void t.log("Невозможно получить корень SVG или HTML документа.")}o.options.url=n.dataset.url||o.options.url,o.options.id=n.id||o.options.id;let i,a=n.offsetHeight,s=n.offsetWidth;0==a&&0==s?i=200:0==a?i=s:0==s?i=a:(i=a)>s&&(i=s);let r=o.svg.doc.getElementsByTagName("svg")[0];r.setAttribute("width",i),r.setAttribute("height",i),o.options.cx=o.options.height/2,o.options.cy=(o.options.height-o.options.diagramcentercy)/2+o.options.diagramcentercy,o.methods.createIndicator(),o.methods.getSensor(),setInterval(o.methods.getSensor,1e3*o.options.interval)},getSensor:function(){try{window.$.jsonp({url:o.options.url,data:{id:o.options.id},callbackParameter:"callback",timeout:9e4,success:function(t){0!=t.lenght&&o.methods.renderValue(t.v)},error:function(e,n,i){t.log("ArrowIndicator getSensor("+o.options.id+") event: "+JSON.stringify(e)+" textStatus: "+n+" error: "+i)}})}catch(o){return void t.log("незагружен модуль jsonp "+o)}},renderValue:function(t){o.svg.doc.getElementById("value").innerHTML=t+" V";const e=o.svg.doc.getElementById("path-value"),n=o.options.data2[o.options.data2.length-1]-o.options.data2[0];let i=0,a=o.options.indicatorColors[0];for(let e=0;e<o.options.data2.length-1;e++)t>o.options.data2[e]&&(i=t-o.options.data2[0],a=o.options.indicatorColors[e]);e.setAttribute("stroke",a);const s=o.options.indicatorRadiuses-o.options.indicatorBgWidth/2-o.options.indicatorWidth/2-2,r=100*i/n*o.options.maxAngle/100;e.setAttribute("d",o.methods.indicator(o.options.cx,o.options.cy,s,0,r))},createIndicator:function(){const t=o.svg.doc.getElementById("scene");let e=o.svg.doc.getElementById("name");e.setAttribute("x",o.options.cx),e.setAttribute("y",25),e.textContent=o.options.textName;const n=window.SVG.createElement("path",{id:"path-value","fill-opacity":0,"stroke-width":o.options.indicatorBgWidth});t.appendChild(n);const i=o.options.data2[o.options.data2.length-1]-o.options.data2[0];let a=0;for(let e=0;e<o.options.data2.length-1;e++){let n=100*(o.options.data2[e+1]-o.options.data2[0])/i*o.options.maxAngle/100;const s=window.SVG.createElement("path",{"fill-opacity":0,stroke:o.options.indicatorColors[e],"stroke-width":o.options.indicatorWidth,d:o.methods.indicator(o.options.cx,o.options.cy,o.options.indicatorRadiuses,a,n)});t.appendChild(s),o.methods.textIndicator(a,o.options.data2[e],t),a=n}o.methods.textIndicator(a,o.options.data2[o.options.data2.length-1],t)},textIndicator:function(t,e,n){const i=o.methods.polarToCartesian(o.options.cx,o.options.cy,o.options.indicatorRadiuses+10,t),a=t+270-(o.options.maxAngle-180)/2,s=window.SVG.createElement("text",{x:i.x,y:i.y,"text-anchor":"middle",transform:"rotate("+a+","+i.x+","+i.y+")"});s.textContent=e,n.appendChild(s)},polarToCartesian:function(t,e,n,i){var a=(i+180-(o.options.maxAngle-180)/2)*Math.PI/180;return{x:t+n*Math.cos(a),y:e+n*Math.sin(a)}},indicator:function(t,e,n,i,a){var s=o.methods.polarToCartesian(t,e,n,i),r=o.methods.polarToCartesian(t,e,n,a),d=a-i<=180?0:1;return["M",s.x,s.y,"A",n,n,0,d,1,r.x,r.y].join(" ")}},{init:function(t){o.methods.init(t)}}}(),window.$=function(){const t={options:{callbackName:"_jqjsp",timeout:1e4}};return t.methods={init:function(o){t.options.callbackName=o.callbackName||t.options.callbackName,t.options.timeout=o.timeout||t.options.timeout;let e="_"+Math.round(1e4*Math.random()),n=o.data||{},i=o.url,a=o.success||function(){},s=o.error||function(){},r=t.methods.startTimer(i,s);for(let o in n)i=t.methods.appendParam(i,o,n[o]);i=t.methods.appendParam(i,"callback",t.options.callbackName),t.methods.addScript(e,i,s,e),window[t.options.callbackName]=(o=>{t.methods.clear(e,r),a(o)})},appendParam:function(t,o,e){return t+(t.indexOf("?")>0?"&":"?")+o+"="+e},clear:function(o,e){null!=e&&window.clearTimeout(e),delete window[t.options.callbackName];let n=document.getElementById(o);null!=n&&n.parentNode.removeChild(n)},addScript:function(t,o,e){const n=document.createElementNS("http://www.w3.org/2000/svg","script");n.setAttribute("type","text/javascript"),n.setAttribute("async",!0),n.setAttribute("id",t),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o),n.addEventListener("error",e),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("svg")[0]).appendChild(n)},startTimer:function(o,e,n){return window.setTimeout(()=>{t.methods.clear(n,null),e("Request timeout.",o)},t.options.timeout)}},{jsonp:function(o){t.methods.init(o)}}}(),window.SVG={svgns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(t,o){let e=document.createElementNS(this.svgns,t);return o&&this.setAttr(e,o),e},setAttr:function(t,o){o.href&&(t.setAttributeNS(this.xlink,"href",o.href),delete o.href),o.src&&(t.setAttributeNS(this.xlink,"href",o.src),delete o.src);for(let e in o)t.setAttribute(e,o[e])}};]]></script><g id="scene"><rect width="100%" height="100%" rx="4" ry="4"/><text id="name" x="50%" y="25" text-anchor="middle">Name</text><text id="value" x="100" y="160" text-anchor="middle">0</text></g></svg>